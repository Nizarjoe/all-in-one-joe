<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Personal Management</title>
  <style>
    :root {
      --primary:#007bff;
      --danger:#dc3545;
      --secondary:#6c757d;
      --bg:#f5f6fa;
      --card:#fff;
    }
    body { font-family: 'Segoe UI', sans-serif; margin:0; background:var(--bg); color:#333; }
    header { background:var(--primary); color:#fff; padding:1rem; text-align:center; }
    nav { display:flex; overflow-x:auto; background:#fff; box-shadow:0 1px 4px rgba(0,0,0,0.1); }
    nav button { flex:1; padding:0.8rem; border:none; background:#fff; cursor:pointer; font-weight:500; transition:0.3s; }
    nav button:hover { background:#f0f0f0; }
    nav button.active { color:var(--primary); border-bottom:3px solid var(--primary); }
    section { display:none; padding:1rem; }
    section.active { display:block; }
    .card { background:var(--card); padding:1rem; border-radius:12px; margin-bottom:1rem; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    .btn { padding:0.5rem 1rem; border:none; border-radius:6px; cursor:pointer; font-size:0.9rem; }
    .btn.primary { background:var(--primary); color:#fff; }
    .btn.danger { background:var(--danger); color:#fff; }
    .btn.secondary { background:var(--secondary); color:#fff; }
    table { width:100%; border-collapse:collapse; margin-top:0.5rem; }
    th, td { padding:0.6rem; border-bottom:1px solid #eee; text-align:left; font-size:0.9rem; }
    input, select, textarea { padding:0.6rem; margin:0.3rem 0; width:100%; border:1px solid #ddd; border-radius:6px; }
    ul { list-style:none; padding:0; }
    ul li { padding:0.6rem; margin-bottom:0.5rem; background:#f9f9f9; border-radius:6px; display:flex; justify-content:space-between; align-items:center; }
    canvas { max-width:100%; margin-top:1rem; }
    .login-container { max-width:400px; margin:5rem auto; background:#fff; padding:2rem; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.2); }
    .login-container h2 { margin-bottom:1rem; text-align:center; }
    .login-container input { margin-bottom:1rem; }
    .actions { display:flex; gap:0.5rem; margin-top:1rem; flex-wrap:wrap; }
  </style>
</head>
<body>
<header>
  <h1>All-in-One Personal Management</h1>
</header>

<!-- LOGIN PAGE -->
<div id="login-page" class="login-container">
  <h2>Login</h2>
  <input type="text" id="login-username" placeholder="Username">
  <input type="password" id="login-password" placeholder="Password">
  <button class="btn primary" onclick="login()">Masuk</button>
  <p style="text-align:center; margin-top:1rem; font-size:0.9rem;">Belum punya akun? <a href="#" onclick="register()">Daftar</a></p>
</div>

<!-- APP CONTENT -->
<div id="app" style="display:none;">
  <nav id="menu">
    <button onclick="show('dashboard')" class="active">Dashboard</button>
    <button onclick="show('finance')">Keuangan</button>
    <button onclick="show('notes')">Catatan</button>
    <button onclick="show('tasks')">Tugas</button>
    <button onclick="show('agenda')">Agenda</button>
    <button onclick="show('profile')">Profil</button>
    <button onclick="show('visual')">Visualisasi</button>
    <button onclick="logout()">Logout</button>
  </nav>

  <!-- DASHBOARD -->
  <section id="dashboard" class="active">
    <div class="card">
      <h2>Ringkasan</h2>
      <p>Saldo: <span id="fin-sum">Rp0</span></p>
      <p>Pemasukan: <span id="fin-income">Rp0</span> | Pengeluaran: <span id="fin-expense">Rp0</span></p>
      <p>Total Catatan: <span id="note-count">0</span></p>
      <p>Total Tugas: <span id="task-count">0</span></p>
      <p>Agenda: <span id="agenda-count">0</span></p>
      <div class="actions">
        <button class="btn secondary" onclick="exportExcel()">Export Excel</button>
        <button class="btn secondary" onclick="exportWord()">Export Word</button>
        <button class="btn secondary" onclick="backupData()">Backup JSON</button>
        <input type="file" id="importFile" style="display:none" onchange="importData(event)">
        <button class="btn secondary" onclick="document.getElementById('importFile').click()">Import JSON</button>
      </div>
    </div>
  </section>

  <!-- KEUANGAN -->
  <section id="finance">
    <div class="card">
      <h2>Manajemen Keuangan</h2>
      <form onsubmit="addTransaction(event)">
        <input type="date" id="fin-date" required>
        <select id="fin-type">
          <option value="income">Pemasukan</option>
          <option value="expense">Pengeluaran</option>
        </select>
        <input type="text" id="fin-cat" placeholder="Kategori">
        <input type="number" id="fin-amount" placeholder="Jumlah" required>
        <input type="text" id="fin-desc" placeholder="Deskripsi">
        <button class="btn primary" type="submit">Tambah</button>
      </form>
      <table>
        <thead><tr><th>Tanggal</th><th>Jenis</th><th>Kategori</th><th>Deskripsi</th><th>Jumlah</th><th>Aksi</th></tr></thead>
        <tbody id="fin-tbody"></tbody>
      </table>
      <canvas id="chart-cat"></canvas>
    </div>
  </section>

  <!-- CATATAN -->
  <section id="notes">
    <div class="card">
      <h2>Catatan Harian</h2>
      <form onsubmit="addNote(event)">
        <input type="text" id="note-title" placeholder="Judul" required>
        <textarea id="note-content" placeholder="Isi catatan" required></textarea>
        <button class="btn primary" type="submit">Simpan</button>
      </form>
      <ul id="note-list"></ul>
    </div>
  </section>

  <!-- TUGAS -->
  <section id="tasks">
    <div class="card">
      <h2>Manajemen Tugas</h2>
      <form onsubmit="addTask(event)">
        <input type="text" id="task-title" placeholder="Judul Tugas" required>
        <input type="date" id="task-date" required>
        <button class="btn primary" type="submit">Tambah</button>
      </form>
      <ul id="task-list"></ul>
    </div>
  </section>

  <!-- AGENDA -->
  <section id="agenda">
    <div class="card">
      <h2>Agenda</h2>
      <form onsubmit="addAgenda(event)">
        <input type="date" id="agenda-date" required>
        <input type="text" id="agenda-event" placeholder="Acara" required>
        <button class="btn primary" type="submit">Tambah</button>
      </form>
      <ul id="agenda-list"></ul>
    </div>
  </section>

  <!-- PROFIL -->
  <section id="profile">
    <div class="card">
      <h2>Profil Saya</h2>
      <input type="text" id="profile-name" placeholder="Nama">
      <input type="text" id="profile-email" placeholder="Email">
      <button class="btn primary" onclick="saveProfile()">Simpan</button>
    </div>
  </section>

  <!-- VISUALISASI -->
  <section id="visual">
    <div class="card">
      <h2>Visualisasi Data</h2>
      <canvas id="chart-summary"></canvas>
      <canvas id="chart-tasks"></canvas>
      <canvas id="chart-agenda"></canvas>
    </div>
  </section>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
/* === LOGIN SYSTEM === */
function login(){
  const u = login-username.value, p = login-password.value;
  const user = JSON.parse(localStorage.getItem('user')||'{}');
  if(user.username===u && user.password===p){
    login-page.style.display='none'; app.style.display='block'; renderAll();
  } else alert('Username atau password salah!');
}
function register(){
  if(!login-username.value||!login-password.value){ alert('Isi username & password untuk daftar'); return; }
  localStorage.setItem('user', JSON.stringify({username:login-username.value,password:login-password.value}));
  alert('Registrasi berhasil, silakan login!');
}
function logout(){ app.style.display='none'; login-page.style.display='block'; }

/* === STORAGE === */
let store = JSON.parse(localStorage.getItem('data')||'{"finances":[],"notes":[],"tasks":[],"agenda":[],"profile":{}}');
function save(){ localStorage.setItem('data',JSON.stringify(store)); }

/* === NAVIGATION === */
function show(id){
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
  document.querySelector(`nav button[onclick="show('${id}')"]`).classList.add('active');
  document.getElementById(id).classList.add('active');
  renderAll();
}

/* === UTIL === */
const IDR=new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR'});
function fmtDate(d){return new Date(d).toLocaleDateString('id-ID');}

/* === FINANCE === */
function addTransaction(e){
  e.preventDefault();
  store.finances.push({id:Date.now(),date:fin-date.value,type:fin-type.value,cat:fin-cat.value,amount:+fin-amount.value,desc:fin-desc.value});
  save(); renderFinance(); renderDashboard();
}
function deleteTransaction(id){ store.finances=store.finances.filter(f=>f.id!=id); save(); renderFinance(); renderDashboard(); }
let chartCat;
function renderFinance(){
  fin-tbody.innerHTML=''; let saldo=0,inc=0,exp=0,byCat={};
  for(const r of store.finances){
    fin-tbody.innerHTML+=`<tr><td>${fmtDate(r.date)}</td><td>${r.type}</td><td>${r.cat}</td><td>${r.desc}</td><td>${IDR.format(r.amount)}</td><td><button class="btn danger" onclick="deleteTransaction('${r.id}')">X</button></td></tr>`;
    if(r.type==='income'){inc+=r.amount;saldo+=r.amount;} else {exp+=r.amount;saldo-=r.amount;byCat[r.cat||'Lainnya']=(byCat[r.cat||'Lainnya']||0)+r.amount;}
  }
  fin-sum.textContent=IDR.format(saldo); fin-income.textContent=IDR.format(inc); fin-expense.textContent=IDR.format(exp);
  if(chartCat)chartCat.destroy();
  chartCat=new Chart(chart-cat,{type:'pie',data:{labels:Object.keys(byCat),datasets:[{data:Object.values(byCat),backgroundColor:['#007bff','#28a745','#ffc107','#dc3545','#6c757d']}]},options:{plugins:{legend:{position:'bottom'}}}});
}

/* === NOTES === */
function addNote(e){ e.preventDefault(); store.notes.push({id:Date.now(),title:note-title.value,content:note-content.value}); save(); renderNotes(); renderDashboard(); }
function deleteNote(id){ store.notes=store.notes.filter(n=>n.id!=id); save(); renderNotes(); renderDashboard(); }
function renderNotes(){ note-list.innerHTML=''; for(const n of store.notes){ note-list.innerHTML+=`<li>${n.title}: ${n.content}<button class="btn danger" onclick="deleteNote('${n.id}')">X</button></li>`; } }

/* === TASKS === */
function addTask(e){ e.preventDefault(); store.tasks.push({id:Date.now(),title:task-title.value,date:task-date.value}); save(); renderTasks(); renderDashboard(); }
function deleteTask(id){ store.tasks=store.tasks.filter(t=>t.id!=id); save(); renderTasks(); renderDashboard(); }
function renderTasks(){ task-list.innerHTML=''; for(const t of store.tasks){ task-list.innerHTML+=`<li>${t.title} (${fmtDate(t.date)})<button class="btn danger" onclick="deleteTask('${t.id}')">X</button></li>`; } }

/* === AGENDA === */
function addAgenda(e){ e.preventDefault(); store.agenda.push({id:Date.now(),date:agenda-date.value,event:agenda-event.value}); save(); renderAgenda(); renderDashboard(); }
function deleteAgenda(id){ store.agenda=store.agenda.filter(a=>a.id!=id); save(); renderAgenda(); renderDashboard(); }
function renderAgenda(){ agenda-list.innerHTML=''; for(const a of store.agenda){ agenda-list.innerHTML+=`<li>${fmtDate(a.date)} - ${a.event}<button class="btn danger" onclick="deleteAgenda('${a.id}')">X</button></li>`; } }

/* === PROFILE === */
function saveProfile(){ store.profile={name:profile-name.value,email:profile-email.value}; save(); }
function renderProfile(){ profile-name.value=store.profile.name||''; profile-email.value=store.profile.email||''; }

/* === VISUALISASI === */
let chartSummary, chartTasks, chartAgenda;
function renderVisual(){
  if(chartSummary)chartSummary.destroy();
  chartSummary=new Chart(chart-summary,{type:'bar',data:{labels:['Pemasukan','Pengeluaran'],datasets:[{label:'Rp',data:[store.finances.filter(f=>f.type==='income').reduce((a,b)=>a+b.amount,0),store.finances.filter(f=>f.type==='expense').reduce((a,b)=>a+b.amount,0)],backgroundColor:['#28a745','#dc3545']}]}});

  if(chartTasks)chartTasks.destroy();
  chartTasks=new Chart(chart-tasks,{type:'line',data:{labels:store.tasks.map(t=>fmtDate(t.date)),datasets:[{label:'Tugas',data:store.tasks.map(()=>1),borderColor:'#007bff',fill:false}]}});
  
  if(chartAgenda)chartAgenda.destroy();
  chartAgenda=new Chart(chart-agenda,{type:'bar',data:{labels:store.agenda.map(a=>fmtDate(a.date)),datasets:[{label:'Agenda',data:store.agenda.map(()=>1),backgroundColor:'#ffc107'}]}});
}

/* === DASHBOARD === */
function renderDashboard(){
  fin-sum.textContent=IDR.format(store.finances.reduce((s,f)=>s+(f.type==='income'?f.amount:-f.amount),0));
  fin-income.textContent=IDR.format(store.finances.filter(f=>f.type==='income').reduce((s,f)=>s+f.amount,0));
  fin-expense.textContent=IDR.format(store.finances.filter(f=>f.type==='expense').reduce((s,f)=>s+f.amount,0));
  note-count.textContent=store.notes.length; task-count.textContent=store.tasks.length; agenda-count.textContent=store.agenda.length;
}

/* === EXPORT & BACKUP === */
function exportExcel(){
  let csv="Sheet,Data\nSaldo,"+fin-sum.textContent+"\nPemasukan,"+fin-income.textContent+"\nPengeluaran,"+fin-expense.textContent;
  const blob=new Blob([csv],{type:'text/csv'}); const a=document.createElement('a');
  a.href=URL.createObjectURL(blob); a.download="data.xlsx"; a.click();
}
function exportWord(){
  let content=`<h1>Ringkasan Data</h1><p>Saldo: ${fin-sum.textContent}</p><p>Pemasukan: ${fin-income.textContent}</p><p>Pengeluaran: ${fin-expense.textContent}</p>`;
  const blob=new Blob(['\ufeff',content],{type:'application/msword'}); const a=document.createElement('a');
  a.href=URL.createObjectURL(blob); a.download="data.doc"; a.click();
}
function backupData(){ const blob=new Blob([JSON.stringify(store)],{type:"application/json"}); const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download="backup.json"; a.click(); }
function importData(e){ const f=e.target.files[0]; if(!f)return; const r=new FileReader(); r.onload=x=>{ store=JSON.parse(x.target.result); save(); renderAll(); }; r.readAsText(f); }

/* === INIT === */
function renderAll(){ renderFinance(); renderNotes(); renderTasks(); renderAgenda(); renderProfile(); renderVisual(); renderDashboard(); }
</script>
</body>
</html>        <svg width="26" height="26" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2L20 7V17L12 22L4 17V7L12 2Z" stroke="url(#g)" stroke-width="2"/>
          <defs>
            <linearGradient id="g" x1="0" y1="0" x2="24" y2="24" gradientUnits="userSpaceOnUse">
              <stop stop-color="var(--accent)"/><stop offset="1" stop-color="var(--accent-2)"/>
            </linearGradient>
          </defs>
        </svg>
        <span>Personal Management</span>
        <span class="badge">ALL‑IN‑ONE</span>
      </div>
      <div class="row">
        <button class="btn ghost" id="btn-backup-json" title="Backup ke JSON">Backup JSON</button>
        <label class="btn" for="import-json" title="Pulihkan dari JSON">Import JSON</label>
        <input id="import-json" type="file" accept="application/json" style="display:none" />
      </div>
    </header>

    <nav class="tabs" id="tabs"></nav>

    <main>
      <!-- DASHBOARD -->
      <section id="tab-dashboard" class="active">
        <div class="grid grid-3">
          <div class="card">
            <h3>Ringkasan Keuangan</h3>
            <div class="stat"><span class="muted">Total Saldo</span><strong id="dash-saldo">Rp 0</strong></div>
            <div class="stat"><span class="muted">Pemasukan Bulan Ini</span><strong id="dash-income">Rp 0</strong></div>
            <div class="stat"><span class="muted">Pengeluaran Bulan Ini</span><strong id="dash-expense">Rp 0</strong></div>
          </div>
          <div class="card">
            <h3>Tugas & Catatan</h3>
            <div class="stat"><span class="muted">Tugas Selesai</span><strong id="dash-done">0</strong></div>
            <div class="stat"><span class="muted">Tugas Belum Selesai</span><strong id="dash-todo">0</strong></div>
            <div class="stat"><span class="muted">Jumlah Catatan</span><strong id="dash-notes">0</strong></div>
          </div>
          <div class="card">
            <h3>Agenda</h3>
            <div class="stat"><span class="muted">Event Hari Ini</span><strong id="dash-today">0</strong></div>
            <div class="stat"><span class="muted">Event Bulan Ini</span><strong id="dash-month">0</strong></div>
            <div class="stat"><span class="muted">Profil Tersimpan</span><strong id="dash-profile">-</strong></div>
          </div>
        </div>
        <div class="grid grid-2" style="margin-top:14px">
          <div class="card">
            <div class="flex-between"><h3>Grafik Keuangan (Bulan Ini)</h3><span class="muted">By Kategori</span></div>
            <canvas id="chart-finance" height="140"></canvas>
          </div>
          <div class="card">
            <div class="flex-between"><h3>Agenda Terdekat</h3><button class="btn ghost" onclick="switchTab('agenda')">Kelola Agenda</button></div>
            <div id="upcoming-list"></div>
          </div>
        </div>
      </section>

      <!-- KEUANGAN -->
      <section id="tab-keuangan">
        <div class="card">
          <h3>Input Transaksi</h3>
          <div class="grid grid-3">
            <div>
              <label>Tanggal</label>
              <input type="date" id="fin-date" />
            </div>
            <div>
              <label>Jenis</label>
              <select id="fin-type">
                <option value="income">Pemasukan</option>
                <option value="expense">Pengeluaran</option>
              </select>
            </div>
            <div>
              <label>Kategori</label>
              <input type="text" id="fin-cat" placeholder="Gaji, Makan, Transport..." />
            </div>
            <div>
              <label>Deskripsi</label>
              <input type="text" id="fin-desc" placeholder="Contoh: Gaji bulanan" />
            </div>
            <div>
              <label>Jumlah</label>
              <input type="number" id="fin-amount" placeholder="0" />
            </div>
            <div class="row" style="align-items:end">
              <button class="btn primary" onclick="addTransaction()">Simpan</button>
              <button class="btn" onclick="clearFinanceForm()">Reset</button>
            </div>
          </div>
        </div>

        <div class="grid grid-2" style="margin-top:14px">
          <div class="card">
            <div class="flex-between">
              <h3>Daftar Transaksi</h3>
              <div class="row">
                <select id="fin-filter-month" onchange="renderFinance()"></select>
                <button class="btn danger" onclick="deleteAll('finances')">Hapus Semua</button>
              </div>
            </div>
            <div class="hr"></div>
            <div style="overflow:auto">
              <table>
                <thead><tr><th>Tanggal</th><th>Jenis</th><th>Kategori</th><th>Deskripsi</th><th>Jumlah</th><th></th></tr></thead>
                <tbody id="fin-tbody"></tbody>
              </table>
            </div>
          </div>
          <div class="card">
            <h3>Grafik & Saldo</h3>
            <div class="stat"><span class="muted">Saldo</span><strong id="fin-sum">Rp 0</strong></div>
            <div class="stat"><span class="muted">Total Pemasukan</span><strong id="fin-income">Rp 0</strong></div>
            <div class="stat"><span class="muted">Total Pengeluaran</span><strong id="fin-expense">Rp 0</strong></div>
            <canvas id="chart-cat" height="160" style="margin-top:10px"></canvas>
          </div>
        </div>
      </section>

      <!-- CATATAN & TUGAS -->
      <section id="tab-notes">
        <div class="grid grid-2">
          <div class="card">
            <h3>Catatan Harian</h3>
            <div class="grid">
              <textarea id="note-text" rows="3" placeholder="Tulis catatan singkat..."></textarea>
              <div class="row">
                <button class="btn primary" onclick="addNote()">Tambah Catatan</button>
                <button class="btn danger" onclick="deleteAll('notes')">Hapus Semua</button>
              </div>
            </div>
            <div class="hr"></div>
            <div id="notes-list"></div>
          </div>
          <div class="card">
            <h3>Daftar Tugas</h3>
            <div class="row">
              <input id="task-text" placeholder="Tugas baru..." />
              <button class="btn primary" onclick="addTask()">Tambah</button>
              <button class="btn danger" onclick="deleteAll('tasks')">Hapus Semua</button>
            </div>
            <div class="hr"></div>
            <div id="tasks-list"></div>
          </div>
        </div>
      </section>

      <!-- AGENDA & JADWAL -->
      <section id="tab-agenda">
        <div class="grid grid-2">
          <div class="card">
            <h3>Tambah Jadwal</h3>
            <div class="grid grid-2">
              <div>
                <label>Tanggal</label>
                <input type="date" id="evt-date" />
              </div>
              <div>
                <label>Waktu</label>
                <input type="time" id="evt-time" />
              </div>
              <div class="grid" style="grid-column: 1 / -1">
                <label>Deskripsi</label>
                <input type="text" id="evt-desc" placeholder="Contoh: Meeting proyek" />
              </div>
              <div class="row" style="grid-column: 1 / -1">
                <button class="btn primary" onclick="addEvent()">Simpan</button>
                <button class="btn" onclick="clearEventForm()">Reset</button>
                <button class="btn danger" onclick="deleteAll('events')">Hapus Semua</button>
              </div>
            </div>
            <div class="hr"></div>
            <div id="events-list"></div>
          </div>
          <div class="card">
            <div class="flex-between">
              <h3>Kalender Mini</h3>
              <div class="row">
                <button class="btn" onclick="navMonth(-1)">◀</button>
                <div class="pill" id="cal-title">-</div>
                <button class="btn" onclick="navMonth(1)">▶</button>
              </div>
            </div>
            <div class="hr"></div>
            <div class="calendar" id="calendar"></div>
          </div>
        </div>
      </section>

      <!-- PROFIL -->
      <section id="tab-profil">
        <div class="card">
          <h3>Informasi Pribadi</h3>
          <div class="grid grid-3">
            <div><label>Nama</label><input id="pf-name" placeholder="Nama lengkap" /></div>
            <div><label>Email</label><input id="pf-email" placeholder="email@contoh.com" /></div>
            <div><label>No. HP</label><input id="pf-phone" placeholder="08xxxx" /></div>
            <div class="grid" style="grid-column: 1 / -1"><label>Alamat</label><input id="pf-address" placeholder="Alamat lengkap" /></div>
            <div class="grid" style="grid-column: 1 / -1"><label>Catatan</label><textarea id="pf-notes" rows="3" placeholder="Informasi tambahan..."></textarea></div>
            <div class="row" style="grid-column: 1 / -1">
              <button class="btn primary" onclick="saveProfile()">Simpan Profil</button>
              <button class="btn" onclick="loadProfile()">Muat Kembali</button>
              <button class="btn danger" onclick="clearProfile()">Hapus Profil</button>
            </div>
          </div>
        </div>
      </section>

      <!-- EKSPOR / IMPOR -->
      <section id="tab-export">
        <div class="grid grid-2">
          <div class="card">
            <h3>Ekspor Data</h3>
            <div class="row">
              <button class="btn primary" onclick="exportExcel()">Ekspor ke Excel (.xlsx)</button>
              <button class="btn" onclick="exportWord()">Ekspor ke Word (.docx)</button>
            </div>
            <p class="muted" style="margin-top:8px">Semua data (keuangan, catatan, tugas, agenda, profil) diekspor.</p>
          </div>
          <div class="card">
            <h3>Impor / Reset</h3>
            <div class="row">
              <label class="btn" for="import-json-2">Impor dari JSON</label>
              <input id="import-json-2" type="file" accept="application/json" style="display:none" />
              <button class="btn danger" onclick="resetAll()">Reset Semua Data</button>
            </div>
            <p class="muted" style="margin-top:8px">Anda juga bisa backup & restore lewat tombol di bagian header.</p>
          </div>
        </div>
      </section>
    </main>

    <footer>
      Dibuat untuk Anda – single-file, ringan, dan siap hosting. Data tersimpan otomatis di <strong>localStorage</strong>.
    </footer>
  </div>

<script>
// ==========================
// UTIL & STATE MANAGEMENT
// ==========================
const IDR = new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 });
const tabs = [
  { id: 'dashboard', label: 'Dashboard' },
  { id: 'keuangan', label: 'Keuangan' },
  { id: 'notes', label: 'Catatan & Tugas' },
  { id: 'agenda', label: 'Agenda & Kalender' },
  { id: 'profil', label: 'Profil' },
  { id: 'export', label: 'Ekspor/Impor' },
];

const store = {
  finances: [], // {id, date(yyyy-mm-dd), type, cat, desc, amount}
  notes: [], // {id, text, dateISO}
  tasks: [], // {id, text, done, dateISO}
  events: [], // {id, date, time, desc}
  profile: {}, // {name, email, phone, address, notes}
};

function loadAll() {
  for (const k of Object.keys(store)) {
    const raw = localStorage.getItem('pm_' + k);
    if (raw) {
      try { store[k] = JSON.parse(raw); } catch { /* ignore */ }
    }
  }
}
function saveAll() {
  for (const k of Object.keys(store)) {
    localStorage.setItem('pm_' + k, JSON.stringify(store[k]));
  }
}
function uid() { return Math.random().toString(36).slice(2) + Date.now().toString(36); }
function fmtDate(d) { return new Date(d + 'T00:00:00').toLocaleDateString('id-ID'); }
function todayYMD(){ const d=new Date(); return d.toISOString().slice(0,10); }

function switchTab(id) {
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.toggle('active', b.dataset.id===id));
  document.querySelectorAll('main section').forEach(s=>s.classList.toggle('active', s.id==='tab-' + id));
  // rerender things that need layout
  if (id==='dashboard') renderDashboard();
  if (id==='keuangan') renderFinance();
  if (id==='notes') { renderNotes(); renderTasks(); }
  if (id==='agenda') { renderEvents(); renderCalendar(); }
  if (id==='profil') loadProfile();
}

// Build tabs
(function initTabs(){
  const nav = document.getElementById('tabs');
  for (const t of tabs) {
    const btn = document.createElement('button');
    btn.className = 'tab-btn' + (t.id==='dashboard' ? ' active' : '');
    btn.textContent = t.label;
    btn.dataset.id = t.id;
    btn.onclick = () => switchTab(t.id);
    nav.appendChild(btn);
  }
})();

// ==========================
// DASHBOARD
// ==========================
let chartFinanceDashboard;
function renderDashboard() {
  // Saldo dan ringkasan bulan ini
  const month = (new Date()).toISOString().slice(0,7); // yyyy-mm
  let saldo = 0, inc=0, exp=0;
  const byCat = {};
  for (const t of store.finances) {
    const amt = Number(t.amount)||0;
    if (t.type==='income') saldo+=amt; else saldo-=amt;
    if ((t.date||'').startsWith(month)) {
      if (t.type==='income') inc+=amt; else exp+=amt;
      const key = t.cat || 'Lainnya';
      byCat[key] = (byCat[key]||0) + (t.type==='expense' ? amt : -amt); // positive expense weight
    }
  }
  document.getElementById('dash-saldo').textContent = IDR.format(saldo);
  document.getElementById('dash-income').textContent = IDR.format(inc);
  document.getElementById('dash-expense').textContent = IDR.format(exp);

  // Tugas & catatan
  const done = store.tasks.filter(t=>t.done).length;
  const todo = store.tasks.length - done;
  document.getElementById('dash-done').textContent = done;
  document.getElementById('dash-todo').textContent = todo;
  document.getElementById('dash-notes').textContent = store.notes.length;

  // Agenda
  const today = todayYMD();
  const todayCount = store.events.filter(e=>e.date===today).length;
  const monthCount = store.events.filter(e=> (e.date||'').startsWith(month)).length;
  document.getElementById('dash-today').textContent = todayCount;
  document.getElementById('dash-month').textContent = monthCount;
  document.getElementById('dash-profile').textContent = store.profile?.name ? 'Sudah' : 'Belum';

  // Upcoming list (7 hari ke depan)
  const now = new Date();
  const weekLater = new Date(now.getTime()+7*24*3600*1000);
  const upcoming = store.events
    .map(e=>({ ...e, dt: new Date(e.date + 'T' + (e.time||'00:00')) }))
    .filter(e=> e.dt>=now && e.dt<=weekLater)
    .sort((a,b)=>a.dt-b.dt)
    .slice(0,8);
  const holder = document.getElementById('upcoming-list');
  holder.innerHTML = upcoming.length ? '' : '<p class="muted">Tidak ada agenda 7 hari ke depan.</p>';
  for (const u of upcoming) {
    const div = document.createElement('div');
    div.className = 'stat';
    div.innerHTML = `<span class="muted">${u.dt.toLocaleString('id-ID')}</span><strong>${u.desc||'-'}</strong>`;
    holder.appendChild(div);
  }

  // Chart by category (expenses positive)
  const ctx = document.getElementById('chart-finance');
  const labels = Object.keys(byCat);
  const data = labels.map(k=> Math.max(byCat[k],0));
  if (chartFinanceDashboard) chartFinanceDashboard.destroy();
  chartFinanceDashboard = new Chart(ctx, {
    type: 'bar', data: { labels, datasets: [{ label: 'Pengeluaran per Kategori (bulan ini)', data }] }, options:{ responsive:true, maintainAspectRatio:false }
  });
}

// ==========================
// KEUANGAN
// ==========================
let chartCat;
function addTransaction(){
  const date = document.getElementById('fin-date').value || todayYMD();
  const type = document.getElementById('fin-type').value;
  const cat = (document.getElementById('fin-cat').value||'').trim() || (type==='income'?'Pemasukan':'Pengeluaran');
  const desc = document.getElementById('fin-desc').value.trim();
  const amount = Number(document.getElementById('fin-amount').value||0);
  if (!amount) return alert('Jumlah tidak boleh 0');
  store.finances.push({ id: uid(), date, type, cat, desc, amount });
  saveAll();
  clearFinanceForm();
  renderFinance();
  renderDashboard();
}
function clearFinanceForm(){
  document.getElementById('fin-date').value = '';
  document.getElementById('fin-type').value = 'income';
  document.getElementById('fin-cat').value = '';
  document.getElementById('fin-desc').value = '';
  document.getElementById('fin-amount').value = '';
}
function deleteTransaction(id){
  const i = store.finances.findIndex(x=>x.id===id);
  if (i>-1) { store.finances.splice(i,1); saveAll(); renderFinance(); renderDashboard(); }
}
function monthOptions(selectId){
  const sel = document.getElementById(selectId);
  const months = [...new Set(store.finances.map(f=> (f.date||'').slice(0,7)).filter(Boolean))].sort().reverse();
  const cur = (new Date()).toISOString().slice(0,7);
  const opts = [cur, ...months.filter(m=>m!==cur)];
  sel.innerHTML = opts.map(m=>`<option value="${m}">${m}</option>`).join('');
}
function renderFinance(){
  monthOptions('fin-filter-month');
  const month = document.getElementById('fin-filter-month').value || (new Date()).toISOString().slice(0,7);
  const rows = store.finances
    .filter(f=> (f.date||'').startsWith(month))
    .sort((a,b)=> a.date.localeCompare(b.date))
  ;
  const tbody = document.getElementById('fin-tbody');
  tbody.innerHTML = '';
  let saldo=0, inc=0, exp=0; const byCat={};
  for (const r of rows) {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${fmtDate(r.date)}</td><td><span class="pill">${r.type==='income'?'Pemasukan':'Pengeluaran'}</span></td><td>${r.cat||'-'}</td><td>${r.desc||'-'}</td><td>${IDR.format(r.amount)}</td><td><button class="btn danger" onclick="deleteTransaction('${r.id}')">Hapus</button></td>`;
    tbody.appendChild(tr);
    if (r.type==='income'){ inc+=r.amount; saldo+=r.amount; } else { exp+=r.amount; saldo-=r.amount; }
    if (r.type==='expense') byCat[r.cat||'Lainnya']=(byCat[r.cat||'Lainnya']||0)+r.amount;
  }
  document.getElementById('fin-sum').textContent = IDR.format(saldo);
  document.getElementById('fin-income').textContent = IDR.format(inc);
  document.getElementById('fin-expense').textContent = IDR.format(exp);

  const labels = Object.keys(byCat);
  const data = labels.map(k=>byCat[k]);
  if (chartCat) chartCat.destroy();
  chartCat = new Chart(document.getElementById('chart-cat'), {
    type:'doughnut', data:{ labels, datasets:[{ label:'Pengeluaran', data }] }, options:{ responsive:true, maintainAspectRatio:false }
  });
}

// ==========================
// CATATAN & TUGAS
// ==========================
function addNote(){
  const text = (document.getElementById('note-text').value||'').trim();
  if (!text) return;
  store.notes.unshift({ id: uid(), text, dateISO: new Date().toISOString() });
  saveAll();
  document.getElementById('note-text').value='';
  renderNotes();
  renderDashboard();
}
function renderNotes(){
  const wrap = document.getElementById('notes-list');
  wrap.innerHTML = store.notes.length? '' : '<p class="muted">Belum ada catatan.</p>';
  for (const n of store.notes) {
    const div = document.createElement('div');
    div.className='stat';
    const d = new Date(n.dateISO).toLocaleString('id-ID');
    div.innerHTML = `<div><div class="muted">${d}</div><div>${n.text}</div></div><div><button class="btn danger" onclick="delItem('notes','${n.id}')">Hapus</button></div>`;
    wrap.appendChild(div);
  }
}
function addTask(){
  const text = (document.getElementById('task-text').value||'').trim();
  if (!text) return;
  store.tasks.unshift({ id: uid(), text, done:false, dateISO: new Date().toISOString() });
  saveAll();
  document.getElementById('task-text').value='';
  renderTasks();
  renderDashboard();
}
function toggleTask(id){
  const t = store.tasks.find(x=>x.id===id);
  if (t) { t.done=!t.done; saveAll(); renderTasks(); renderDashboard(); }
}
function renderTasks(){
  const wrap = document.getElementById('tasks-list');
  wrap.innerHTML = store.tasks.length? '' : '<p class="muted">Belum ada tugas.</p>';
  for (const t of store.tasks) {
    const div = document.createElement('div');
    div.className='stat';
    div.innerHTML = `<div><label><input type="checkbox" ${t.done?'checked':''} onchange="toggleTask('${t.id}')"/> <span ${t.done?'style="text-decoration:line-through;opacity:.7"':''}>${t.text}</span></label></div><div class="row"><button class="btn danger" onclick="delItem('tasks','${t.id}')">Hapus</button></div>`;
    wrap.appendChild(div);
  }
}

// ==========================
// AGENDA & KALENDER
// ==========================
let calYear=(new Date()).getFullYear(), calMonth=(new Date()).getMonth();
function addEvent(){
  const date = document.getElementById('evt-date').value || todayYMD();
  const time = document.getElementById('evt-time').value || '';
  const desc = (document.getElementById('evt-desc').value||'').trim();
  if (!desc) return alert('Deskripsi harus diisi.');
  store.events.push({ id: uid(), date, time, desc });
  saveAll();
  clearEventForm();
  renderEvents();
  renderCalendar();
  renderDashboard();
}
function clearEventForm(){
  document.getElementById('evt-date').value='';
  document.getElementById('evt-time').value='';
  document.getElementById('evt-desc').value='';
}
function delEvent(id){ delItem('events', id); renderEvents(); renderCalendar(); renderDashboard(); }
function renderEvents(){
  const wrap = document.getElementById('events-list');
  const list = [...store.events].sort((a,b)=> (a.date+a.time).localeCompare(b.date+b.time));
  wrap.innerHTML = list.length? '' : '<p class="muted">Belum ada jadwal.</p>';
  for (const e of list) {
    const div = document.createElement('div');
    div.className='stat';
    const t = (e.time||'').slice(0,5);
    div.innerHTML = `<div><div class="muted">${fmtDate(e.date)} ${t?('• '+t):''}</div><div>${e.desc}</div></div><div><button class="btn danger" onclick="delEvent('${e.id}')">Hapus</button></div>`;
    wrap.appendChild(div);
  }
}
function navMonth(delta){
  calMonth += delta;
  if (calMonth<0){ calMonth=11; calYear--; }
  if (calMonth>11){ calMonth=0; calYear++; }
  renderCalendar();
}
function renderCalendar(){
  const title = document.getElementById('cal-title');
  const monthName = new Date(calYear, calMonth, 1).toLocaleString('id-ID', { month:'long', year:'numeric' });
  title.textContent = monthName;
  const cal = document.getElementById('calendar');
  cal.innerHTML = '';
  const first = new Date(calYear, calMonth, 1);
  const startDay = (first.getDay()+6)%7; // make Monday=0
  const days = new Date(calYear, calMonth+1, 0).getDate();
  for (let i=0;i<startDay;i++){ const d=document.createElement('div'); d.className='cell'; cal.appendChild(d); }
  const today = new Date();
  for (let d=1; d<=days; d++){
    const cell = document.createElement('div');
    cell.className = 'cell';
    const ymd = `${calYear}-${String(calMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const has = store.events.some(e=>e.date===ymd);
    const isToday = (today.getFullYear()===calYear && today.getMonth()===calMonth && today.getDate()===d);
    if (isToday) cell.classList.add('today');
    cell.innerHTML = `<div class="d">${d}</div>${has?'<div class="dot"></div>':''}`;
    cal.appendChild(cell);
  }
}

// ==========================
// PROFIL
// ==========================
function loadProfile(){
  const p = store.profile || {};
  document.getElementById('pf-name').value = p.name||'';
  document.getElementById('pf-email').value = p.email||'';
  document.getElementById('pf-phone').value = p.phone||'';
  document.getElementById('pf-address').value = p.address||'';
  document.getElementById('pf-notes').value = p.notes||'';
}
function saveProfile(){
  store.profile = {
    name: document.getElementById('pf-name').value.trim(),
    email: document.getElementById('pf-email').value.trim(),
    phone: document.getElementById('pf-phone').value.trim(),
    address: document.getElementById('pf-address').value.trim(),
    notes: document.getElementById('pf-notes').value.trim(),
  };
  saveAll();
  alert('Profil disimpan.');
  renderDashboard();
}
function clearProfile(){ if (confirm('Hapus profil?')) { store.profile = {}; saveAll(); loadProfile(); renderDashboard(); }}

// ==========================
// EKSPOR / IMPOR
// ==========================
function exportExcel(){
  const wb = XLSX.utils.book_new();
  // Finances
  const finData = [['Tanggal','Jenis','Kategori','Deskripsi','Jumlah']].concat(
    store.finances.map(f=>[f.date, f.type, f.cat||'', f.desc||'', f.amount])
  );
  XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(finData), 'Keuangan');
  // Notes
  const noteData = [['Tanggal','Catatan']].concat(store.notes.map(n=>[new Date(n.dateISO).toLocaleString('id-ID'), n.text]));
  XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(noteData), 'Catatan');
  // Tasks
  const taskData = [['Tanggal','Tugas','Selesai?']].concat(store.tasks.map(t=>[new Date(t.dateISO).toLocaleString('id-ID'), t.text, t.done?'Ya':'Tidak']));
  XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(taskData), 'Tugas');
  // Events
  const evtData = [['Tanggal','Waktu','Deskripsi']].concat(store.events.map(e=>[e.date, e.time, e.desc]));
  XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(evtData), 'Agenda');
  // Profile
  const p = store.profile||{};
  const profData = [['Field','Nilai'], ['Nama', p.name||''], ['Email', p.email||''], ['HP', p.phone||''], ['Alamat', p.address||''], ['Catatan', p.notes||'']];
  XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(profData), 'Profil');

  const wbout = XLSX.write(wb, { bookType:'xlsx', type:'array' });
  saveAs(new Blob([wbout], {type:'application/octet-stream'}), 'Personal-Management.xlsx');
}

async function exportWord(){
  const { Document, Packer, Paragraph, HeadingLevel, TextRun } = window.docx;
  const p = store.profile||{};
  function H(t){ return new Paragraph({ text: t, heading: HeadingLevel.HEADING_2 }); }
  function para(t){ return new Paragraph({ children: [new TextRun(t)] }); }

  const sections = [];
  sections.push(H('Profil')); 
  sections.push(para(`Nama: ${p.name||''}`));
  sections.push(para(`Email: ${p.email||''}`));
  sections.push(para(`HP: ${p.phone||''}`));
  sections.push(para(`Alamat: ${p.address||''}`));
  sections.push(para(`Catatan: ${p.notes||''}`));

  sections.push(H('Keuangan'));
  for (const f of store.finances) sections.push(para(`${fmtDate(f.date)} | ${f.type==='income'?'Pemasukan':'Pengeluaran'} | ${f.cat||'-'} | ${f.desc||'-'} | ${IDR.format(f.amount)}`));

  sections.push(H('Catatan'));
  for (const n of store.notes) sections.push(para(`${new Date(n.dateISO).toLocaleString('id-ID')} – ${n.text}`));

  sections.push(H('Tugas'));
  for (const t of store.tasks) sections.push(para(`[${t.done?'x':' '}] ${t.text}`));

  sections.push(H('Agenda'));
  for (const e of store.events) sections.push(para(`${fmtDate(e.date)} ${e.time||''} – ${e.desc}`));

  const doc = new Document({ sections: [{ properties: {}, children: sections }] });
  const blob = await Packer.toBlob(doc);
  saveAs(blob, 'Personal-Management.docx');
}

// JSON backup / restore
function backupJSON(){
  const data = JSON.stringify(store, null, 2);
  const blob = new Blob([data], {type:'application/json'});
  saveAs(blob, 'Personal-Management.json');
}
function importJSONFile(file){
  const reader = new FileReader();
  reader.onload = () => {
    try {
      const data = JSON.parse(reader.result);
      for (const k of Object.keys(store)) store[k] = data[k] || (Array.isArray(store[k])? [] : {});
      saveAll();
      // refresh UI
      loadProfile(); renderFinance(); renderNotes(); renderTasks(); renderEvents(); renderCalendar(); renderDashboard();
      alert('Impor selesai.');
    } catch (e) { alert('File tidak valid.'); }
  };
  reader.readAsText(file);
}
function resetAll(){
  if (!confirm('Yakin ingin menghapus semua data?')) return;
  for (const k of Object.keys(store)) store[k] = Array.isArray(store[k])? [] : {};
  saveAll();
  // refresh UI
  loadProfile(); renderFinance(); renderNotes(); renderTasks(); renderEvents(); renderCalendar(); renderDashboard();
  alert('Semua data direset.');
}

// Generic helpers
function delItem(key, id){
  const arr = store[key];
  const i = arr.findIndex(x=>x.id===id);
  if (i>-1){ arr.splice(i,1); saveAll(); }
}
function deleteAll(key){
  if (!confirm('Hapus semua?')) return;
  store[key] = [];
  saveAll();
  if (key==='finances') renderFinance();
  if (key==='notes') renderNotes();
  if (key==='tasks') renderTasks();
  if (key==='events') { renderEvents(); renderCalendar(); }
  renderDashboard();
}

// Header buttons wiring
document.getElementById('btn-backup-json').addEventListener('click', backupJSON);
for (const id of ['import-json','import-json-2']){
  const el = document.getElementById(id);
  el.addEventListener('change', (e)=>{ const f = e.target.files?.[0]; if (f) importJSONFile(f); e.target.value=''; });
}

// INIT
loadAll();
renderDashboard();
renderFinance();
renderNotes();
renderTasks();
renderEvents();
renderCalendar();
loadProfile();

// Pre-fill if empty (optional UX)
(function seed(){
  if (store.finances.length===0) {
    store.finances.push(
      {id:uid(), date: todayYMD(), type:'income', cat:'Gaji', desc:'Gaji awal', amount: 1000000},
      {id:uid(), date: todayYMD(), type:'expense', cat:'Makan', desc:'Sarapan', amount: 20000}
    );
  }
  saveAll();
})();
</script>
</body>
</html>
